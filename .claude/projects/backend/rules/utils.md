# utils ディレクトリ コーディング規約

## ディレクトリの詳細な説明

汎用的なユーティリティ関数やヘルパー関数を格納するディレクトリ。データベース接続、共通処理、ライブラリのラッパー関数など、アプリケーション全体で再利用される機能を提供する。インフラ層として機能する。

## 命名規則

- **ファイル名**: 機能名を snake_case で命名
  - 例: `database.py`
- **関数名**: 動詞から始まる snake_case
  - 例: `get_db`
- **変数名**:
  - グローバル定数: UPPER_SNAKE_CASE（例: `DATABASE_URL`）
  - インスタンス: PascalCase（例: `SessionLocal`）
  - ローカル変数: snake_case

## コードの基本構造

- **必要なライブラリの import**: 標準ライブラリ、サードパーティ、自作モジュールの順
- **設定値の取得**: config モジュールから設定値を取得
- **グローバル変数・定数の定義**: モジュールレベルでの初期化
- **ユーティリティ関数の定義**: 再利用可能な関数群
- **型ヒント必須**: Generator、Session 等の型を明示

## 関数・クラス設計について

- **純粋関数**: 副作用のない関数を推奨
- **ジェネレータ関数**: リソース管理が必要な場合に使用
  - 例: `def get_db() -> Generator[Session, None, None]:`
- **依存関係の分離**: config から設定値を取得し、ハードコーディングを避ける
- **リソース管理**: try-finally でリソースの確実な解放

## 例外処理について

- **リソース管理**: try-finally でデータベース接続を確実にクローズ
- **例外の伝播**: 下位レイヤーでキャッチせず上位に委譲
- **ログ出力**: 重要な例外は適切にログに記録
- **設定エラー**: 起動時に設定値の妥当性を検証
